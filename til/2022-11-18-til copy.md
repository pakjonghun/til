---
date: 2022-11-18
category: til
---

## 오늘 한 일

- 상태관리 고민하기
  - vanilla js 에서 proxy, pubsub 이용해보기
  - redux, recoil, mobx 중 canvas 에 가장 어울리는 상태관리 툴 고민하기
- css 성능과 편의성 고민하기
  - css in js 와 css 중 성능이 좋은 것은 css 인것 같지만.
  - 편의성이 css in js 보다 뒤떨어지는 것이 문제라고 생각한다.
  - scss를 사용하면 될 것 같기도 하고, postcss 만 써도 될 것 같기도 하다.

## 고민의 과정

- canvas 를 사용하면서 state 를 관리 해야 할 일이 많아졌다.
  - 현재 mobx 를 사용해서 각 컴포넌트를 class 형식으로 만들어서 mobx 와 같이 상태관리를 하고 있는데
  - 이렇게 하면서 불편한 점이 생겼다
    - mobx 는 알아서 depth 를 따져주지 않는다. 컴포넌트가 받은 props 가 이미 부모가 관리하는 상태라면
    - 이 depth 보다 더 깊은 depth 의 상태를 mobx 로 해당 컴포넌트에서 추적 할 수 없다.
    - 정확히 말하면 또 다른 별도의 저장소를 만들거나 depth 를 따져 가면서 state 를 건드려야 한다.
    - 이미 작성된 프로젝트에서는 위와 같은 이유 때문에
    - 새로운 state 를 추가 하려면 뎁스를 일일히 따져봐야 하는 번거로움이 있다.
    - 즉 객체지향적인 사고를 하면서 스테이트를 추가 해야 한다는 것이다(어느 클레스에 어울리는 스테이트인지 확인하고 컴포넌트의 부모 자식 모두 확인 하면서 진행 할 필요가 있음)
    - 중앙에 새출발 하는 생각으로 새로운 저장소를 만들면 편하긴 하지만 갈수록 엉망이 되어 가는 저장소를 보면 그렇게 하는 것은 별로 좋은 생각이 아닌 것 같다.
    - 물론 class 인 요소, 컴포넌트 에서는 상관이 없어보이지만(곧바로 상태 추적 시키면됨)
    - 문제는 props 를 받는 함수형 컴포넌트다. (객체지향과.. 함수지향...의 혼합??)
    - 뎁스가 깊어질 수록 글로벌한 스테이트 관리가 오히려 복잡해 질 수 있다.
  - mobx 는 커뮤니티가 의외로 좁다.
    - 업데이트가 활발히 일어나지 않고 있어서 불안한 면이 있으며,
    - util 함수도 의외로 쓸만한 부분을 쉽게 찾기 어려웠다.(공식홈에는 링크 하나가 끝임 충격...)
    - log 를 관리하는 툴도 있기는 하지만 redux 보다 보기 힘들어 보임.
  - 하지만 observer 패턴과 proxy 를 사용하고, 불변성을 지킬 필요가 없다는 부분은 긍정적!
  - mobx를 걷어내고, 별도로 proxy를 이용해서 상태관리 시스템을 만들어 볼까? 하는 생각이 들 정도로
  - 어떤 면에서는 좋은 툴이라는 생각이 들었다.(별도의 추가되는 패턴이나 라이브러리가 비교적 적다는점)
- css in js 는 css 에 js 를 넣어서 작성하므로 편하다 는 장점이 있다.
  - 하지만 이게 스타일을 위한 컴포넌트인지...일반 컴포넌트 인지.. 구분이 어렵고
  - 작명을 일일히 해야하는 번거로움과
  - jsx 를 보고 바로 구조를 파악하기 어렵다는(작명과는 별개로 어떤 태그 인지 바로 확인이 어려움)문제가 있다
  - 그리고 가장 큰 단점으로 꼽히는 부분은 성능인데
  - js -> css 파싱을 하므로 그냥 css 보다는 한템보 성능이 떨어 질 수 밖에 없다는 점이다.
  - 하지만 확실히 편하긴 하다 js 를 css 에 섞어서 쓰고
  - scss 처럼 nesting 도 할수 있다(styled.component 의 경우.)
  - 언젠가 편의성과 성능을 둘다 잡은 멋진 방식이 나오긴 하겠지만...

## 결론

- state 관리는 정답이 없다. 언제 어떻게 바뀔지 모른다.
  - 현재 대세는 함수형 프로그래밍 이고
    - 이에 맞는 상태관리 툴로는 redux, recoil 등이 있다.
    - 하지만 canvas 를 이용할 때 객체지향형 으로 작업 하는 것이 편할 수 있으며
    - 객체지향에 맞춰서 상태관리하기 편한 툴은 mobx 가 있다.
  - 상태관리 툴은 모두 장단점이 있고, 상황에 따라 골라서 사용해야 한다는 것이 결론이다.
  - 그리고 변하지 않는 핵심 기술중 하나는 역시 pubsub obserever proxy 패턴 이고
    - 이 방식을 사용은 하지 않더라도 이해는 하고 있어야 한다고 생각했다.
  - 마지막으로 react의 ctx api 도 은근 많이 사용되고 있고, react 에서도 계속 발전 시키고 있고,
    - 테스트를 위해서 mobx 를 ctx 와 섞어서 사용하는 경우도 있으므로
    - react ctx api 도 좀 이해를 명확히 할 필요가 있다고 생각했다.
- css 역시 정답이 없다... 언제 또 어떻게 바뀔지 모른다.
  - 하지만 확실히 스타일링의 근본이 되는 핵심 기술은 역시 css 라는 생각이 든다.
  - 그래서 postcss 위주로 착실히 학습 하는 것이 가장 좋은 학습 방법이라는 결론을 내렸고
  - postcss 이든 styled-component 든 클라이언트의 요구에 맞추거나 기획된 대로 따라가는 것이 일단 좋다는 생각을 했다.
  - 개인적으로 css 는 프레임 워크보다는 postCss 를 쓰면 좋다는 생각을 계속 하게 된다.
