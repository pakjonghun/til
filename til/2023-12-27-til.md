—
date: 2023-12-27
category: til
—

## 개요

- ecs 서비스 사용 후기 정리
- 특히 보안 관련 secretManager 나 ,iam 설정 방법 정리
- 사용 후 꾸준히 확인해야 하는부분 및 비용 부분 정리
- 서비스 사용 하면서 느낀점, 생각 정리

## 문제인식

- 쓴만큼 비용을 지불하면서 안정적인 서버 관리가 되는 솔루션의 필요성을 느끼고 있다.
- 특히 클라이언트가 비용과 관련없이 비교적 안전한(트레픽 관리, 방화멱 관리 등) 서버를 요구 할 경우 특히 이 솔루션이 필요하다고 생각했다.
- 위 솔루션에 대한 지식 부재를 첫번째 문제점이라고 인식했다.
- 두번째는 정작 해당 기술을 익힌다고 하더라도 실제로 자주 사용하지 않는 기술이고, 업데이트가 꾸준히 일어나서 사용법이 꾸준히 바뀔 수 있다고 생각했다.
- 즉 최대한 간단한 솔루션 적용 방법을 알아두어야 나중에 두고두고 써먹을 수 있다고 생각했다.
- 기술을 지속적인 사용을 위한 기억하기 쉬운 적용 방법이 필요하다고 생각했다.

## AWS 특히 보안에 좋은 솔루션이라는 생각이 든다.

- Secret manager 라는 서비스가 있다.
- 이 서비스는 환경변수를 저장해 두었다가 인증 후 환경변수를 받아서 사용 할 수 있게 하는 서비스다.
- 사용방법은 다양하다 사용자 인증을 거쳐서 aws - sdk 로 접근 할 수도 있고
- aws 내부 서비스를 사용 할 경우 내부 서비스에 arn (aws 만의 고유한 아이디)를 사용해서 접근 할 수 도 있고,
- role을 만들어서 해당 권한을 부여한 다음 접근해서 사용 할 수도 있다.
- 이 서비스의 좋은 점은, 보안에 매우 뛰어나다는 점이다.
- 환경변수를 인증 을 거쳐서 받을 뿐 아니라 암호화된 상태로 받아 볼 수도 있고,
- 특히 aws 내부 서비스인 경우 이런 옵션이 매우 잘 먹힌다.
- 이 외에도 iam 인증을 통해 개발자의 실수를 사전 차단하는 접근 방법이 많이 사용되는데
- 예를 들어 secret manager 에 읽기 기능만 부여받은 사용자, 읽기 쓰기 권한을 부여받은 사용자 로 나누어서 기능으 제약 할 수도 있다.
- iam 은 거의 모든 기능에 적용 이 된다.
- s3 를 사용할 때도 object read, object update, object delete 등등 기능사용에 권한을 부여해서 제약 할 수 있다.
- 다만 처음 사용 해볼 경우 매우 많은 권한의 숫자에 당황 할 수 있을 것 같아서 꼭 필요한것 위주로 어딘가에 적어두거나 gpt 도움을 받거나 googling 을 할 필요가 있을 것 같다.

## 비교적 쉽지만 약간 비용이 더 드는, 하지만 뿌듯한 serverless ecs 방법

- 서버가 알아서 트레픽을 관리하고
- 방화벽도 설정망 해두면 알아서 잘 관리되고,
- 관리형 스케일 을 설정해 두어서 알아서 scale-out, scale-in 이 적용되고
- 나는 사용한 만큼 돈만 내면되고 ㅎㅎ
- 또 내부 서비스에서 다양한 솔루션을 끌어와 사용하고(messageQ, secretManager 등등)
- 위 내용을 만족하는 방법이 aws ecs 이며,
- ecs 의 service 를 생성해서 elastic register와 함께 사용하는 방법이다.
- 11월 말 에 해당 방법을 간략하게 배우게 되서 정리한 적이 있는데
- 이 방법은 비교적 이해하기 쉽고, 사용할때 기억하기 쉽다는 장점이 있다.
- 반면에 aws 계산기로 두드려본 결과
- 4개 서버를 스케일링 이 안일어난다고 생각하고
- 1gb cup, 2gb memory 로 운영 할때,
- 1달에 21만원 정도 기본 비용이 나오는 걸 확인했는데
- 실제 프로젝트에서나 적용할 법 한 비용이지, 개인 토이 프로젝트 부분에는 1개 테스크 정도만
- 사용해야 겠다는 생각이 들었다.

## 사용방법은 내용이 너무 길어져서 별도로 노션에 정리해 두었다.

- 물론 위에 말 처럼 그렇게 쉽게 뚝딱 적용이 되지는 않는다.
- 이런저런 시행착오를 겪고,
- 권한도 잘 적용이 안되거나 doc 임에도 불구하고 예전 버전의 내용이 있는 경우도 있어서
- 고생을 많이 했다.
- 또 고생하지 않기 위해 해당내용을 정리하다 보니 내용이 너무 방대해서 notion 에 별도로 정리했다.
- 앗차, githubAction에서 발행한 토큰을 이용해서 aws 에 로그인 해서 사용 할 수 있는 방법이 있어서
- cd 를 편하게 할수 있는 방법도 있어서 적용했는데
- 너무 좋았다.
- 지금까지 정말 기본적인 내용의 ops 를 사용해 보면서 느낌점을 정리해 보았다.
- 해당 글이 til 이고 느낀점을 회고하는 측면에서 적은 글이라 영양가가 그렇게 크진 않지만
- 적어도 내가 생각을 정리하고, 앞으로 나갈 방향을 정리했다는 점에 의의가 있다고 생각한다.
